{
    // See https://go.microsoft.com/fwlink/?LinkId=733558
    // for the documentation about the tasks.json format
    "version": "2.0.0",
    "options": {
        "env": {
            "PREFECT_LOGGING_LEVEL": "INFO",
            "PREFECT_LOGGING_EXTRA_LOGGERS": "prefect_managedfiletransfer",
            "PREFECT_API_URL": "http://127.0.0.1:4200/api"
        }
    },
    "tasks": [
        {
            "label": "Serve docs",
            "type": "shell",
            "command": "uv run mkdocs serve",
            "isBackground": true,
            "presentation": {
                "reveal": "always",
                "panel": "dedicated"
            },
            "problemMatcher": []
        },
        {
            "label": "Build docs",
            "type": "shell",
            "command": "uv run mkdocs build",
            "presentation": {
                "reveal": "always",
                "panel": "shared"
            },
            "problemMatcher": []
        },
        {
            "label": "Tests with coverage",
            "type": "shell",
            "command": "uv run coverage run -m pytest tests -vv && uv run coverage report",
            "problemMatcher": []
        },
        {
            "label": "Build package",
            "type": "shell",
            "command": "uv build",
            "problemMatcher": []
        },
        {
            "label": "pre-commit",
            "type": "shell",
            "command": "uv run pre-commit run --show-diff-on-failure --color=always --all-files",
            "problemMatcher": []
        },
        {
            "label": "Start prefect server",
            "type": "shell",
            "command": "uv run prefect server start",
            "problemMatcher": {
                "owner": "custom",
                "pattern": {
                    "regexp": "_____"
                },
                "background": {
                    "activeOnStart": true,
                    "beginsPattern": "^.*___*$",
                    "endsPattern": "^.*Check out the dashboard.*$"
                },
            },
            "isBackground": true,
            "presentation": {
                "reveal": "always",
                "panel": "dedicated"
            },
        },
        {
            "label": "Start prefect worker",
            "type": "shell",
            "command": "uv run prefect worker start --pool 'default-pool' --type process",
            "problemMatcher": {
                "owner": "custom",
                "pattern": {
                    "regexp": "_____"
                },
                "background": {
                    "activeOnStart": true,
                    "beginsPattern": "^.*$",
                    "endsPattern": "^.*Worker '.*' started!*$"
                },
            },
            "isBackground": true,
            "presentation": {
                "reveal": "always",
                "panel": "dedicated"
            },
            "dependsOn": [
                "Start prefect server"
            ]
        },
        {
            "label": "Deploy",
            "type": "shell",
            "command": "uv run python -m prefect_managedfiletransfer.deploy --local",
            "problemMatcher": [],
            "dependsOn": [
                "Start prefect worker"
            ]
        },
        {
            // you should  have already started the server on docker externally
            // docker run -p 4200:4200 -d --rm prefecthq/prefect:3-latest -- prefect server start --host 0.0.0.0
            "label": "Start prefect worker-docker",
            "type": "shell",
            "command": "PREFECT_API_URL='http://host.docker.internal:4200/api' uv run prefect worker start --pool 'default-pool' --type docker",
            "problemMatcher": {
                "owner": "custom",
                "pattern": {
                    "regexp": "_____"
                },
                "background": {
                    "activeOnStart": true,
                    "beginsPattern": "^.*$",
                    "endsPattern": "^.*Worker '.*' started!*$"
                },
            },
            "isBackground": true,
            "presentation": {
                "reveal": "always",
                "panel": "dedicated"
            },
        },
        {
            "label": "Deploy-docker",
            "type": "shell",
            "command": "PREFECT_API_URL='http://host.docker.internal:4200/api' uv run python -m prefect_managedfiletransfer.deploy --docker",
            "problemMatcher": [],
            "dependsOn": [
                "Start prefect worker-docker"
            ]
        }
    ]
}